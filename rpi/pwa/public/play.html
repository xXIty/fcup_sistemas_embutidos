<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <title>cm-chessboard</title>
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0"/>
    <link rel="stylesheet" href="/assets/styles/examples.css"/>
    <link rel="stylesheet" href="/assets/styles/cm-chessboard.css"/>
</head>
<body>
<h1><a href="/">RETURN</a></h1>
<h2>Current Game</h2>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<div id="board"></div>
    <button id="but-prev" > *- </button>
    <button id="but-next" > -* </button>
<script type="module">
    import {Chessboard} from "/js/Chessboard.js"

    var board = new Chessboard(document.getElementById("board"), {
        position: "start",
        sprite: {url: "/assets/images/chessboard-sprite-staunty.svg"},
        style: {
            aspectRatio: 0.9
        }
    })
    var fens = []
     var index = 0;
     var max = 0;
    (function() {
        var poll = function() {
          $.ajax({
            url: '/current',
            dataType: 'json',
            type: 'get',
            success: function(data) { // check if available
                console.log(index, data.fens.length);
                fens = data.fens
                if( index == max) { // Most recent on last poll, check updates
                    index = max = fens.length-1;
                    console.log(`Setting ${index}, ${fens[index]}`);
                    board.setPosition(fens[index]);
                }
                if ( false ) { // end of game?
                    clearInterval(pollInterval); // optional: stop poll function
                }
            },
            error: function() { // error logging
              console.log('Error!');
            }
          });
        },
        pollInterval = setInterval(function() { // run function every 2000 ms
          poll();
          }, 300);
        poll(); // also run function on init
    })();

    function decrementIndex() {
        if(index > 0) {
            index -= 1;
            board.setPosition(fens[index]);
        }
    }
    function incrementIndex() {
        if (index < max) {
            index += 1;
            board.setPosition(fens[index]);
        }
    }

    document.getElementById("but-prev").onclick = decrementIndex;
    document.getElementById("but-next").onclick = incrementIndex;

</script>

</body>
</html>
